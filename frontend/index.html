<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>YouTube MCP Agent</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: "Inter", sans-serif;
            background: #0f0f0f;
            color: #fff;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ------------------ SIDEBAR ------------------ */
        .sidebar {
            width: 240px;
            background: #111;
            border-right: 1px solid #222;
            padding-top: 12px;
            overflow-y: auto;
        }

        .sidebar-item {
            padding: 14px 22px;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .sidebar-item:hover {
            background: #1d1d1d;
        }

        /* ------------------ NAVBAR ------------------ */
        .navbar {
            position: fixed;
            left: 240px;
            right: 0;
            height: 70px;
            background: #111;
            border-bottom: 1px solid #222;
            display: flex;
            align-items: center;
            padding: 0 25px;
            gap: 20px;
        }

        .prompt-box {
            width: 60%;
            margin: auto;
            display: flex;
            gap: 10px;
        }

        .prompt-box input {
            width: 100%;
            padding: 12px 14px;
            border-radius: 8px;
            border: 1px solid #333;
            background: #000;
            color: #fff;
            font-size: 15px;
        }

        .prompt-box button {
            padding: 12px 18px;
            background: #2563EB;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }

        .prompt-box button:hover {
            background: #1d4ed8;
        }

        /* ------------------ MAIN CONTENT ------------------ */
        .main {
            margin-left: 240px;
            padding: 20px;
            margin-top: 90px;
            height: calc(100vh - 90px);
            overflow-y: auto;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }

        .video-card {
            background: #181818;
            border-radius: 12px;
            overflow: hidden;
            transition: 0.25s ease;
            border: 1px solid #222;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.45);
            cursor: pointer;
        }

        .thumb {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .video-info {
            padding: 14px;
        }

        .video-info h3 {
            margin: 0;
            font-size: 17px;
            font-weight: 500;
        }

        .video-info small {
            color: #aaa;
        }

        .button-row {
            padding: 14px;
            display: flex;
            gap: 10px;
        }

        .button-row button {
            flex: 1;
            padding: 10px 0;
            border-radius: 8px;
            border: 1px solid #333;
            background: #222;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .button-row button:hover {
            background: #333;
        }

        /* ------------------ TOAST ------------------ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(34, 34, 34, 0.9);
            padding: 14px 22px;
            border-radius: 8px;
            border: 1px solid #444;
            opacity: 0;
            transform: translateY(-20px);
            transition: 0.35s ease;
            z-index: 9999;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-item" onclick="loadHome()">üè† Home</div>
        <div class="sidebar-item" onclick="loadTrending()">üî• Trending</div>
        <div class="sidebar-item" onclick="loadSubscriptions()">üì∫ Subscriptions</div>

        <div style="border-bottom:1px solid #222; margin:12px 0;"></div>

        <div class="sidebar-item" onclick="loadHistory()">üïì History</div>
        <div class="sidebar-item" onclick="loadWatchLater()">‚è± Watch Later</div>
        <div class="sidebar-item" onclick="loadLiked()">üëç Liked Videos</div>
    </div>

    <!-- Top Navbar -->
    <div class="navbar">
        <div class="prompt-box">
            <input id="input" placeholder="Ask your AI agent‚Ä¶ e.g. 'like despacito video', 'search fitness workouts'">
            <button onclick="handlePrompt()">Go</button>
        </div>
    </div>

    <!-- Main -->
    <div class="main">
        <div id="messages"></div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        const API = "https://mcp-agent-1.onrender.com/api";

        /* ------------------- TOAST ------------------- */
        function showToast(msg) {
            let t = document.getElementById("toast");
            t.innerHTML = msg;
            t.classList.add("show");
            setTimeout(() => t.classList.remove("show"), 2600);
        }

        /* ------------------- MESSAGE HELPERS ------------------- */
        function addMessage(t) {
            const m = document.getElementById("messages");
            const p = document.createElement("p");
            p.style.color = "#ccc";
            p.innerHTML = t;
            m.appendChild(p);
        }

        function clearMessages() {
            document.getElementById("messages").innerHTML = "";
        }

        /* ------------------- PROMPT HANDLING ------------------- */
        async function handlePrompt() {
            const text = document.getElementById("input").value.trim();
            if (!text) return;

            document.getElementById("input").value = "";

            const lower = text.toLowerCase();

            if (lower.startsWith("search")) {
                const q = text.replace(/^search/i, "").trim();
                return sendSearch(q);
            }

            if (lower.startsWith("like")) {
                const q = text.replace(/^like/i, "").trim();
                return searchAndAct(q, "like");
            }

            if (lower.startsWith("subscribe")) {
                const q = text.replace(/^subscribe/i, "").trim();
                return searchAndAct(q, "subscribe");
            }

            if (lower.startsWith("comment")) {
                const q = text.replace(/^comment/i, "").trim();
                return searchAndAct(q, "comment");
            }

            addMessage("‚ùå Unrecognized command.");
        }

        /* Search + automatically act on first matching video */
        async function searchAndAct(q, type) {
            addMessage(`Searching for video: ${q}`);

            const res = await fetch(`${API}/search?query=${encodeURIComponent(q)}`);
            const data = await res.json();
            if (!data.length) return showToast("No video found.");

            const video = data[0]; // first result

            if (type === "like") return likeVideo(video.videoId);
            if (type === "subscribe") return subscribeChannel(video.videoId);
            if (type === "comment") {
                let txt = prompt("Enter comment:");
                return commentVideo(video.videoId, txt);
            }
        }

        /* ------------------- SEARCH ------------------- */
        async function sendSearch(query) {
            if (!query) return;
            addMessage("üîé Searching for: " + query);
            const res = await fetch(`${API}/search?query=${encodeURIComponent(query)}`);
            const data = await res.json();
            showVideos(data);
        }

        document.getElementById("input").addEventListener("keypress", e => {
            if (e.key === "Enter") handlePrompt();
        });

        /* ------------------- VIDEO RENDERING ------------------- */
        function showVideos(list) {
            clearMessages();

            const grid = document.createElement("div");
            grid.className = "video-grid";

            list.forEach(v => {
                const c = document.createElement("div");
                c.className = "video-card";

                c.onclick = () => window.open(`https://www.youtube.com/watch?v=${v.videoId}`, "_blank");

                c.innerHTML = `
                    <img class="thumb" src="https://i.ytimg.com/vi/${v.videoId}/hqdefault.jpg">

                    <div class="video-info">
                        <h3>${v.title}</h3>
                        <small>${v.channelTitle}</small>
                    </div>

                    <div class="button-row">
                        <button onclick="event.stopPropagation(); likeVideo('${v.videoId}')">üëç Like</button>
                        <button onclick="event.stopPropagation(); promptComment('${v.videoId}')">üí¨ Comment</button>
                        <button onclick="event.stopPropagation(); subscribeChannel('${v.videoId}')">üîî Subscribe</button>
                    </div>
                `;

                grid.appendChild(c);
            });

            document.getElementById("messages").appendChild(grid);
        }

        /* ------------------- ACTIONS ------------------- */
        async function likeVideo(videoId) {
            const res = await fetch(`${API}/like`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ videoId })
            });
            const data = await res.json();
            showToast(data.message || data.error);
        }

        function promptComment(id) {
            const t = prompt("Enter your comment:");
            if (t) commentVideo(id, t);
        }

        async function commentVideo(videoId, text) {
            const res = await fetch(`${API}/comment`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ videoId, text })
            });
            const d = await res.json();
            showToast(d.message || d.error);
        }

        async function subscribeChannel(videoId) {
            const res = await fetch(`${API}/subscribe`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ videoId })
            });
            const d = await res.json();
            showToast(d.message || d.error);
        }

        /* ------------------- SIDEBAR ------------------- */
        function loadHome() {
            clearMessages();
            addMessage("Enter a search query or give a prompt.");
        }

        function loadTrending() { showToast("Trending not implemented."); }
        function loadSubscriptions() { showToast("Subscriptions not implemented."); }
        function loadHistory() { showToast("History not accessible via API."); }
        function loadWatchLater() { showToast("Watch Later not accessible."); }

        function loadLiked() {
            fetch(`${API}/liked`)
                .then(r => r.json())
                .then(d => showVideos(d));
        }
    </script>

</body>
</html>
