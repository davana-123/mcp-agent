<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YouTube MCP Agent</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

<style>
/* ---------- GLOBAL STYLES ---------- */
body {
  margin: 0;
  font-family: "Roboto", sans-serif;
  background: #0f0f0f;
  color: #fff;
  display: flex;
  overflow: hidden;
  height: 100vh;
}

.sidebar {
  width: 240px;
  background: #111;
  border-right: 1px solid #222;
  padding-top: 15px;
  height: 100vh;
  position: fixed;
  left: 0;
  top: 0;
}

.sidebar-item {
  padding: 14px 24px;
  cursor: pointer;
  font-size: 15px;
  border-radius: 6px;
}

.sidebar-item:hover {
  background: #222;
}

.navbar {
  position: fixed;
  left: 240px;
  right: 0;
  height: 70px;
  background: #111;
  border-bottom: 1px solid #222;
  display: flex;
  align-items: center;
  padding: 0 25px;
  z-index: 10;
}

.search-box {
  width: 45%;
  display: flex;
  gap: 10px;
  margin-left: auto;
  margin-right: auto;
}

.search-box input {
  width: 100%;
  padding: 12px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #000;
  color: white;
}

.search-box button {
  padding: 12px 24px;
  background: #2563EB;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  color: white;
  font-weight: 500;
}

.command-bar {
  position: fixed;
  left: 240px;
  right: 0;
  top: 70px;
  background: #111;
  padding: 14px 25px;
  border-bottom: 1px solid #222;
  z-index: 9;
}

.command-bar input {
  width: 300px;
  padding: 10px;
  border-radius: 6px;
  background: #000;
  border: 1px solid #333;
  color: white;
}

.command-bar button {
  padding: 10px 20px;
  background: #2563EB;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  color: white;
  font-weight: 500;
}

.main {
  margin-left: 240px;
  margin-top: 140px;
  padding: 25px;
  height: calc(100vh - 140px);
  overflow-y: auto;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 25px;
}

.video-card {
  background: #181818;
  border-radius: 12px;
  border: 1px solid #333;
  overflow: hidden;
  transition: .25s;
}

.video-card:hover {
  transform: scale(1.02);
}

.thumb {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.video-info {
  padding: 15px;
}

.video-info h3 {
  margin: 0 0 5px 0;
  font-size: 17px;
}

.video-info small {
  color: #aaa;
}

.button-row {
  padding: 15px;
  display: flex;
  gap: 8px;
}

.button-row button {
  flex: 1;
  padding: 10px;
  background: #222;
  border: 1px solid #444;
  border-radius: 8px;
  color: white;
  cursor: pointer;
}

.button-row button:hover {
  background: #333;
}

.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #222;
  color: #fff;
  padding: 12px 20px;
  border-radius: 6px;
  border: 1px solid #444;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.4s;
  z-index: 1000;
}

.toast.show {
  opacity: 1;
}
</style>
</head>

<body>

<!-- ---------- SIDEBAR ---------- -->
<div class="sidebar">
  <div class="sidebar-item" onclick="loadHome()">üè† Home</div>
  <div class="sidebar-item" onclick="loadTrending()">üî• Trending</div>
  <div class="sidebar-item" onclick="loadSubscriptions()">üì∫ Subscriptions</div>
  <hr style="border-color:#222" />
  <div class="sidebar-item" onclick="loadHistory()">History</div>
  <div class="sidebar-item" onclick="loadWatchLater()">Watch Later</div>
  <div class="sidebar-item" onclick="loadLiked()">Liked</div>
</div>

<!-- ---------- NAVBAR ---------- -->
<div class="navbar">
  <div class="search-box">
    <input id="input" placeholder="Search videos..." />
    <button onclick="send()">Search</button>
  </div>
</div>

<!-- ---------- COMMAND BAR ---------- -->
<div class="command-bar">
  <input id="commandInput" placeholder='Type: "like this video", "unlike", "dislike"' />
  <button onclick="runCommand()">Run</button>
</div>

<!-- ---------- MAIN CONTENT ---------- -->
<div class="main">
  <div id="messages"></div>
</div>

<div id="toast" class="toast"></div>

<script>
const API = "https://mcp-agent-1.onrender.com/api";

/* ---------- Toast ---------- */
function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2500);
}

/* ---------- Search ---------- */
document.getElementById("input").addEventListener("keypress", e => {
  if (e.key === "Enter") send();
});

async function send() {
  const query = input.value.trim();
  if (!query) return;
  input.value = "";
  const res = await fetch(`${API}/search?query=${encodeURIComponent(query)}`);
  showVideos(await res.json());
}

/* ---------- Render Videos ---------- */
function showVideos(list) {
  messages.innerHTML = "";

  const grid = document.createElement("div");
  grid.className = "video-grid";

  list.forEach(v => {
    const card = document.createElement("div");
    card.className = "video-card";

    card.innerHTML = `
      <img class="thumb" src="https://i.ytimg.com/vi/${v.videoId}/hqdefault.jpg">
      <div class="video-info">
        <h3>${v.title}</h3>
        <small>${v.channelTitle}</small>
      </div>
      <div class="button-row">
        <button class="like-btn" onclick="likeVideo('${v.videoId}')">üëç Like</button>
        <button onclick="commentVideo('${v.videoId}')">üí¨ Comment</button>
        <button onclick="subscribeChannel('${v.videoId}')">üîî Subscribe</button>
      </div>
    `;

    grid.appendChild(card);
  });

  messages.appendChild(grid);
}

/* ---------- Actions ---------- */
async function likeVideo(videoId) {
  const res = await fetch(`${API}/like`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({videoId})
  });
  const data = await res.json();
  showToast(data.message || data.error);
}

async function commentVideo(videoId) {
  const text = prompt("Enter your comment:");
  if (!text) return;

  const res = await fetch(`${API}/comment`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({videoId, text})
  });

  showToast((await res.json()).message);
}

async function subscribeChannel(videoId) {
  const res = await fetch(`${API}/subscribe`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({videoId})
  });

  showToast((await res.json()).message);
}

/* ---------- Sidebar ---------- */
function loadHome() { messages.innerHTML = "Search for something above."; }
function loadTrending() { showToast("Feature not implemented"); }
function loadSubscriptions() { showToast("Feature not implemented"); }
function loadHistory() { showToast("History API not available"); }
function loadWatchLater() { showToast("Watch Later API not available"); }

function loadLiked() {
  fetch(`${API}/liked`)
    .then(res => res.json())
    .then(data => showVideos(data));
}

/* ---------- Command System ---------- */
function runCommand() {
  const cmd = document.getElementById("commandInput").value.toLowerCase();
  const likeBtn = document.querySelector(".like-btn");

  if (cmd.includes("like")) {
    if (likeBtn) likeBtn.click();
    showToast("Liked via command");
    return;
  }

  if (cmd.includes("unlike")) {
    showToast("Unlike (UI only)");
    return;
  }

  if (cmd.includes("dislike")) {
    showToast("Dislike (UI only)");
    return;
  }

  showToast("Unknown command");
}
</script>

</body>
</html>
