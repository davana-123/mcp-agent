<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube MCP Agent</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* Global styling */
body {
  margin: 0;
  font-family: "Roboto", sans-serif;
  background: #000;
  color: #fff;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

.sidebar {
  width: 240px;
  background: #111;
  border-right: 1px solid #222;
  overflow-y: auto;
  padding-top: 12px;
}

.sidebar-item {
  padding: 12px 22px;
  font-size: 15px;
  cursor: pointer;
}

.sidebar-item:hover {
  background: #1f1f1f;
}

.navbar {
  position: fixed;
  left: 240px;
  right: 0;
  height: 65px;
  background: #111;
  border-bottom: 1px solid #222;
  display: flex;
  align-items: center;
  padding: 0 20px;
}

.search-box {
  width: 50%;
  margin: auto;
  display: flex;
}

.search-box input {
  width: 100%;
  padding: 10px;
  border: 1px solid #333;
  background: #000;
  color: white;
}

.search-box button {
  padding: 10px 16px;
  background: #2563EB;
  border: none;
  color: white;
  cursor: pointer;
}

.main {
  margin-left: 240px;
  padding: 20px;
  margin-top: 85px;
  height: calc(100vh - 85px);
  overflow-y: auto;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 25px;
}

.video-card {
  background: #181818;
  border: 1px solid #333;
  border-radius: 10px;
  overflow: hidden;
  transition: 0.2s;
}

.video-card:hover {
  transform: scale(1.03);
}

.thumb {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.video-info {
  padding: 12px;
}

.video-info h3 {
  margin: 0;
  font-size: 16px;
}

.video-info small {
  color: #aaa;
}

.button-row {
  padding: 12px;
  display: flex;
  gap: 8px;
}

.button-row button {
  flex: 1;
  padding: 8px;
  background: #222;
  border: 1px solid #333;
  color: white;
  cursor: pointer;
}

.button-row button:hover {
  background: #333;
}
</style>

</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-item">üè† Home</div>
  <div class="sidebar-item">üî• Trending</div>
  <div class="sidebar-item">üì∫ Subscriptions</div>
  <div style="border-bottom:1px solid #222; margin:12px 0;"></div>
  <div class="sidebar-item">History</div>
  <div class="sidebar-item">Watch Later</div>
  <div class="sidebar-item">Liked Videos</div>
</div>

<!-- Top Navbar -->
<div class="navbar">
  <div class="search-box">
    <input id="input" placeholder="Search videos...">
    <button onclick="send()">Search</button>
  </div>
</div>

<!-- Main -->
<div class="main">
  <div id="messages"></div>
</div>

<script>
// --------------------------
// CONFIG
// --------------------------
const API = "https://mcp-agent-1.onrender.com/api";

// --------------------------
// Helpers
// --------------------------
function addMessage(text) {
  const messages = document.getElementById("messages");
  const p = document.createElement("p");
  p.innerHTML = text;
  p.style.color = "#aaa";
  messages.appendChild(p);
}

function clearMessages() {
  document.getElementById("messages").innerHTML = "";
}

// --------------------------
// SEARCH / COMMAND HANDLER
// --------------------------
async function send() {
  const input = document.getElementById("input");
  const query = input.value.trim();
  if (!query) return;

  input.value = "";

  const cmd = query.toLowerCase();

  try {
    if (cmd.startsWith("search")) {
      const q = query.replace(/search/i, "").trim();
      addMessage("üîé Searching for: " + q);
      const res = await fetch(`${API}/search?query=${encodeURIComponent(q)}`);
      const data = await res.json();
      showVideos(data);
      return;
    }

    if (cmd.includes("liked")) {
      addMessage("‚ù§Ô∏è Loading liked videos...");
      const res = await fetch(`${API}/liked`);
      const data = await res.json();
      showVideos(data);
      return;
    }

    if (cmd.includes("recommend")) {
      addMessage("üéØ Loading recommendations...");
      const res = await fetch(`${API}/recommend`);
      const data = await res.json();
      showVideos(data);
      return;
    }

    addMessage("ü§ñ Commands: search <q>, liked, recommend");
  } catch (error) {
    addMessage("‚ö†Ô∏è Error: " + error.message);
  }
}

// --------------------------
// Render videos
// --------------------------
function showVideos(list) {
  clearMessages();

  const grid = document.createElement("div");
  grid.className = "video-grid";

  list.forEach(v => {
    const card = document.createElement("div");
    card.className = "video-card";

    card.innerHTML = `
      <img class="thumb" src="https://i.ytimg.com/vi/${v.videoId}/hqdefault.jpg">
      <div class="video-info">
        <h3>${v.title}</h3>
        <small>${v.channelTitle}</small>
      </div>
      <div class="button-row">
        <button onclick="likeVideo('${v.videoId}')">üëç Like</button>
        <button onclick="commentVideo('${v.videoId}')">üí¨ Comment</button>
        <button onclick="subscribeChannel('${v.videoId}')">üîî Subscribe</button>
      </div>
    `;

    grid.appendChild(card);
  });

  document.getElementById("messages").appendChild(grid);
}

// --------------------------
// ACTIONS
// --------------------------
async function likeVideo(videoId) {
  const res = await fetch(`${API}/like`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId })
  });
  const data = await res.json();
  addMessage(data.message || data.error);
}

async function commentVideo(videoId) {
  const text = prompt("Enter your comment:");
  if (!text) return;

  const res = await fetch(`${API}/comment`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId, text })
  });
  const data = await res.json();
  addMessage(data.message || data.error);
}

async function subscribeChannel(videoId) {
  const res = await fetch(`${API}/subscribe`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId })
  });
  const data = await res.json();
  addMessage(data.message || data.error);
}
</script>

</body>
</html>
