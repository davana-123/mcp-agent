<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube MCP Agent</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* Global styling */
body {
  margin: 0;
  font-family: "Roboto", sans-serif;
  background: #000;
  color: #fff;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

.sidebar {
  width: 240px;
  background: #111;
  border-right: 1px solid #222;
  overflow-y: auto;
  padding-top: 12px;
}

.sidebar-item {
  padding: 12px 22px;
  font-size: 15px;
  cursor: pointer;
}

.sidebar-item:hover {
  background: #1f1f1f;
}

.navbar {
  position: fixed;
  left: 240px;
  right: 0;
  height: 65px;
  background: #111;
  border-bottom: 1px solid #222;
  display: flex;
  align-items: center;
  padding: 0 20px;
}

.search-box {
  width: 50%;
  margin: auto;
  display: flex;
}

.search-box input {
  width: 100%;
  padding: 10px;
  border: 1px solid #333;
  background: #000;
  color: white;
}

.search-box button {
  padding: 10px 16px;
  background: #2563EB;
  border: none;
  color: white;
  cursor: pointer;
}

.main {
  margin-left: 240px;
  padding: 20px;
  margin-top: 140px;
  height: calc(100vh - 140px);
  overflow-y: auto;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 25px;
}

.video-card {
  background: #181818;
  border: 1px solid #333;
  border-radius: 10px;
  overflow: hidden;
  transition: 0.2s;
}

.video-card:hover {
  transform: scale(1.03);
  cursor: pointer;
}

.thumb {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.video-info {
  padding: 12px;
}

.video-info h3 {
  margin: 0;
  font-size: 16px;
}

.video-info small {
  color: #aaa;
}

.button-row {
  padding: 12px;
  display: flex;
  gap: 8px;
}

.button-row button {
  flex: 1;
  padding: 8px;
  background: #222;
  border: 1px solid #333;
  color: white;
  cursor: pointer;
}

.button-row button:hover {
  background: #333;
}

/* Toast Notification */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #222;
  color: #fff;
  padding: 12px 20px;
  border-radius: 6px;
  border: 1px solid #444;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 9999;
}

.toast.show {
  opacity: 1;
  pointer-events: auto;
}
</style>

</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-item" onclick="loadHome()">üè† Home</div>
  <div class="sidebar-item" onclick="loadTrending()">üî• Trending</div>
  <div class="sidebar-item" onclick="loadSubscriptions()">üì∫ Subscriptions</div>
  <div style="border-bottom:1px solid #222; margin:12px 0;"></div>
  <div class="sidebar-item" onclick="loadHistory()">History</div>
  <div class="sidebar-item" onclick="loadWatchLater()">Watch Later</div>
  <div class="sidebar-item" onclick="loadLiked()">Liked Videos</div>
</div>

<!-- Top Navbar -->
<div class="navbar">
  <div class="search-box">
    <input id="input" placeholder="Search videos...">
    <button onclick="send()">Search</button>
  </div>
</div>

<!-- Command Bar -->
<div style="margin-left:240px; padding:15px; background:#111; border-bottom:1px solid #222;">
  <input id="commandInput"
         placeholder='Type: "like this video", "unlike", "dislike"'
         style="width:300px; padding:8px; background:#000; color:white; border:1px solid #333;">
  <button onclick="runCommand()" 
          style="padding:8px 15px; background:#2563EB; color:white; border:none; cursor:pointer;">
    Run
  </button>
</div>

<!-- Main -->
<div class="main">
  <div id="messages"></div>
</div>

<!-- Toast Container -->
<div id="toast"></div>

<script>
const API = "https://mcp-agent-1.onrender.com/api";

// Toast System
function showToast(message) {
  let toast = document.getElementById("toast");
  toast.innerHTML = message;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2500);
}

function addMessage(text) {
  const messages = document.getElementById("messages");
  const p = document.createElement("p");
  p.innerHTML = text;
  p.style.color = "#aaa";
  messages.appendChild(p);
}

function clearMessages() {
  document.getElementById("messages").innerHTML = "";
}

document.getElementById('input').addEventListener('keypress', function (e) {
  if (e.key === 'Enter') send();
});

// Search
async function send() {
  const input = document.getElementById("input");
  const query = input.value.trim();
  if (!query) return;
  input.value = "";

  addMessage("üîé Searching for: " + query);

  const res = await fetch(`${API}/search?query=${encodeURIComponent(query)}`);
  const data = await res.json();
  showVideos(data);
}

// Render Videos
function showVideos(list) {
  clearMessages();

  const grid = document.createElement("div");
  grid.className = "video-grid";

  list.forEach(v => {
    const card = document.createElement("div");
    card.className = "video-card";

    card.onclick = () => {
      window.open(`https://www.youtube.com/watch?v=${v.videoId}`, "_blank");
    };

    card.innerHTML = `
      <img class="thumb" src="https://i.ytimg.com/vi/${v.videoId}/hqdefault.jpg">
      <div class="video-info">
        <h3>${v.title}</h3>
        <small>${v.channelTitle}</small>
      </div>

      <div class="button-row">
        <button class="like-btn" onclick="event.stopPropagation(); likeVideo('${v.videoId}')">üëç Like</button>
        <button onclick="event.stopPropagation(); commentVideo('${v.videoId}')">üí¨ Comment</button>
        <button onclick="event.stopPropagation(); subscribeChannel('${v.videoId}')">üîî Subscribe</button>
      </div>
    `;

    grid.appendChild(card);
  });

  document.getElementById("messages").appendChild(grid);
}

// Actions
async function likeVideo(videoId) {
  const res = await fetch(`${API}/like`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId })
  });
  const data = await res.json();
  showToast(data.message || data.error);
}

async function commentVideo(videoId) {
  const text = prompt("Enter your comment:");
  if (!text) return;

  const res = await fetch(`${API}/comment`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId, text })
  });
  const data = await res.json();
  showToast(data.message || data.error);
}

async function subscribeChannel(videoId) {
  const res = await fetch(`${API}/subscribe`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ videoId })
  });
  const data = await res.json();
  showToast(data.message || data.error);
}

// Sidebar
function loadHome() { clearMessages(); addMessage("Enter search query above."); }
function loadTrending() { showToast("Trending not implemented."); }
function loadSubscriptions() { showToast("Subscriptions not implemented."); }
function loadHistory() { showToast("History cannot be accessed via API."); }
function loadWatchLater() { showToast("Watch Later cannot be accessed via API."); }

function loadLiked() {
  fetch(`${API}/liked`)
    .then(res => res.json())
    .then(data => showVideos(data));
}

// ------------------------------
// COMMAND SYSTEM
// ------------------------------
function runCommand() {
  const cmd = document.getElementById("commandInput").value.toLowerCase().trim();

  const likeBtn = document.querySelector(".like-btn");

  if (cmd.includes("like")) {
    if (likeBtn) likeBtn.click();
    showToast("Liked via command");
    return;
  }

  if (cmd.includes("unlike") || cmd.includes("remove")) {
    showToast("Unlike (UI only, backend not implemented)");
    return;
  }

  if (cmd.includes("dislike")) {
    showToast("Dislike (UI only, backend not implemented)");
    return;
  }

  showToast("Unknown command");
}
</script>

</body>
</html>
